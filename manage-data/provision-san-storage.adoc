---
sidebar: sidebar 
permalink: manage-data/provision-san-storage.html 
keywords: provision storage,san, create storage units, luns, namespaces, nvme, add host, add host initiators, map host, host mapping, create, ontap 
summary: '在ASA R2上配置ONTAP存储、以使SAN (SCSI和NVMe)主机能够向指定存储单元(LUN和NVMe命名空间)读写数据。' 
searchtitle: 使用ONTAP系统管理器| ASA R2配置SAN存储 
---
= 在ASA R2系统上配置ONTAP SAN存储
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
配置存储时、您可以使SAN主机能够对ASA R2存储系统执行数据读写操作。要配置存储、请使用ONTAP系统管理器创建存储单元、添加主机启动程序以及将主机映射到存储单元。您还需要在主机上执行相应步骤、以启用读/写操作。



== 创建存储单元

在ASA r2 系统中，存储单元为 SAN 主机提供存储空间，用于数据操作。存储单元指的是 SCSI 主机的 LUN 或 NVMe 主机的 NVMe 命名空间。如果您的集群配置为支持 SCSI 主机，系统会提示您创建 LUN。如果您的集群配置为支持 NVMe 主机，系统会提示您创建 NVMe 命名空间。

ASA r2 存储单元的最大容量为 128 TB。参见link:https://hwu.netapp.com/["NetApp Hardware Universe"^]针对ASA r2 系统的最新存储限制。

在创建存储单元的过程中，您需要将主机启动器添加到存储单元并将其映射到存储单元。你也可以link:provision-san-storage.html#add-host-initiators["添加"]和link:provision-san-storage.html#map-the-storage-unit-to-a-host["映射"]创建存储单元后，主机启动器。

从ONTAP 9.18.1 开始，您可以修改快照保留，并在创建存储单元时启用自动快照删除。快照预留空间是指存储单元中专门为快照保留的空间量。当快照预留空间设置为自动删除快照时，如果快照使用的空间超过快照预留空间，则较旧的快照将自动删除。

link:../data-protection/snapshot-reserve.html["了解更多关于ASA r2 系统快照保留的信息"]。

存储单元默认采用精简配置。精简配置允许存储单元扩展到分配的大小，但不会预先预留空间。空间会根据需要从可用空间中动态分配。这样，您可以通过超额配置可用空间来实现更高的存储效率。例如，假设您有 1 TB 的可用空间，并且您需要创建四个 1 TB 的存储单元。您可以创建存储单元，监控空间利用率，并随着存储单元实际占用空间而增加存储容量，而不是立即向系统中添加 3 TB 的额外存储容量。详细了解link:https://docs.netapp.com/us-en/ontap/concepts/thin-provisioning-concept.html["精简配置"^]。

.步骤
. 在System Manager中，选择*Storage*；然后选择image:icon_add_blue_bg.png["蓝色背景的矩形图标、单词add以白色字母居中"]。
. 输入新存储单元的名称。
. 输入要创建的单位数。
+
如果创建多个存储单元、则每个存储单元的容量、主机操作系统和主机映射都相同。

+
为了优化存储可用区内的工作负载均衡，请创建偶数个存储单元。

. 输入存储单元容量、然后选择主机操作系统。
+

CAUTION: 如果创建多个存储单元，则每个单元的容量都相同。将你要创建的存储单元数量乘以所需的容量，以确保你有足够的可用空间。如果可用空间不足，而你又选择了过度配置，请密切监控使用情况，以避免空间不足和数据丢失。

. 接受自动选择的*主机映射*或为要映射到的存储单元选择其他主机组。
+
*主机映射*是指新存储单元将映射到的主机组。如果您为新存储单元选择的主机类型已存在一个主机组，则会自动选择该主机组进行主机映射。您可以接受自动选择的主机组，也可以选择其他主机组。

+
如果不存在运行您指定的操作系统的主机的预先存在的主机组， ONTAP将自动创建一个新的主机组。

. 如果要执行以下任一操作，请选择*更多选项*并完成所需的步骤。
+
[cols="2, 4a"]
|===
| 选项 | 步骤 


 a| 
更改默认服务质量(QoS)策略

如果先前未在创建存储单元的Storage Virtual Machine (VM)上设置默认QoS策略、则此选项不可用。
 a| 
.. 在*存储和优化*下的*服务质量(QoS)*旁边，选择image:icon_dropdown_arrow.gif["向下箭头的蓝色图标"]。
.. 选择现有QoS策略。




 a| 
创建新的QoS策略
 a| 
.. 在*存储和优化*下的*服务质量(QoS)*旁边，选择image:icon_dropdown_arrow.gif["向下箭头的蓝色图标"]。
.. 选择*Define new policy*。
.. 输入新QoS策略的名称。
.. 设置服务质量限制、服务质量保证或两者都设置。
+
... (可选)在"*Limit*(限制*)"下、输入最大吞吐量限制和/或最大IOPS限制。
+
为存储单元设置最大吞吐量和IOPS可限制其对系统资源的影响、从而不会降低关键工作负载的性能。

... (可选)在*Guarent*下，输入最小吞吐量或最小IOPS，或者同时输入这两者。
+
为存储单元设置最小吞吐量和IOPS可确保该存储单元满足最低性能目标、而不管争用资源的工作负载的需求如何。



.. 选择 * 添加 * 。




 a| 
更改默认性能服务级别。
 a| 
.. 在*存储和优化*下的*性能服务级别*旁边，选择image:icon_dropdown_arrow.gif["向下箭头的蓝色图标"]。
.. 选择*性能*。
+
ASA r2 系统提供两种性能级别。默认性能级别为*极限*，这是可用的最高级别。您可以将级别降低至*性能*。





 a| 
修改默认快照保留设置并启用自动快照删除功能。
 a| 
.. 在“快照预留 %”下，输入要分配给快照的存储单元空间百分比的数值。
.. 选择“自动删除较旧的快照”。




 a| 
添加新的SCSI主机
 a| 
.. 在*Host information*下，选择*SCSI*作为连接协议。
.. 选择主机操作系统。
.. 在*主机映射*下，选择*新主机*。
.. 选择*FC*或*iSCSI*。
.. 选择现有主机启动程序或选择*添加启动程序*以添加新的主机启动程序。
+
有效FC WWPN的示例为"01：02：03：04：0a：0b：0c：0d"。有效iSCSI启动程序名称的示例包括iqn.1995-08.com.example:string"和euui.0123456789abcdef。





 a| 
创建新的SCSI主机组
 a| 
.. 在*Host information*下，选择*SCSI*作为连接协议。
.. 选择主机操作系统。
.. 在*Host Mapping*下，选择*New host group*。
.. 输入主机组的名称；然后选择要添加到该组的主机。




 a| 
添加新的NVMe子系统
 a| 
.. 在*Host information*下，选择*NVMe*作为连接协议。
.. 选择主机操作系统。
.. 在*主机映射*下、选择*新NVMe子系统*。
.. 输入子系统的名称或接受默认名称。
.. 输入启动程序的名称。
.. 如果要启用带内身份验证或传输层安全(TLS)，请选择，image:icon_dropdown_arrow.gif["向下箭头的蓝色图标"]然后选择所需的选项。
+
带内身份验证允许在NVMe主机和ASA R2系统之间进行安全的双向和单向身份验证。

+
TLS会对NVMe/TCP主机与ASA R2系统之间通过网络发送的所有数据进行加密。

.. 选择*添加启动程序*以添加更多启动程序。
+
将主机 NQN 格式化为 <nqn.yyyy-mm>，后跟完全限定域名。年份应等于或晚于 1970 年。总最大长度应为 223。一个有效的 NVMe 发起程序示例是 nqn.2014-08.com.example:string



|===
. 选择 * 添加 * 。


.下一步是什么？
此时将创建存储单元并将其映射到主机。现在、您可以link:../data-protection/create-snapshots.html["创建快照"]保护ASA R2系统上的数据。

.了解更多信息
详细了解 link:../administer/manage-client-vm-access.html["ASA R2系统如何使用Storage Virtual Machine"]。



== 添加主机启动程序

您可以随时向ASA R2系统添加新的主机启动程序。启动程序使主机有资格访问存储单元并执行数据操作。

.开始之前
如果要在添加主机启动程序的过程中将主机配置复制到目标集群、则集群必须处于复制关系中。您也可以link:../data-protection/snapshot-replication.html#step-3-create-a-replication-relationship["创建复制关系"]在添加主机后选择此选项。

为SCSI或NVMe主机添加主机启动程序。

[role="tabbed-block"]
====
.SCSI 主机
--
.步骤
. 选择*主机*。
. 选择*SCSI*；然后选择image:icon_add_blue_bg.png["蓝色矩形的图标、其中包含一个加号、后跟一个白色字母的单词add"]。
. 输入主机名、选择主机操作系统并输入主机说明。
. 如果要将主机配置复制到目标集群，请选择*复制主机配置*；然后选择目标集群。
+
要复制主机配置、集群必须具有复制关系。

. 添加新主机或现有主机。
+
[cols="2"]
|===
| 添加新主机 | 添加现有主机 


 a| 
.. 选择*新主机*。
.. 选择*FC*或*iSCSI*；然后选择主机启动程序。
.. (可选)选择*配置主机邻近*。
+
通过配置主机邻近性、ONTAP可以确定离主机最近的控制器、以优化数据路径并缩短延迟。这仅适用于已将数据复制到远程位置的情况。如果尚未设置快照复制、则无需选择此选项。

.. 如果需要添加新启动程序，请选择*添加启动程序*。

 a| 
.. 选择*现有主机*。
.. 选择要添加的主机。
.. 选择 * 添加 * 。


|===
. 选择 * 添加 * 。


.下一步是什么？
SCSI主机已添加到ASA R2系统、您可以将主机映射到存储单元。

--
.NVMe主机
--
.步骤
. 选择*主机*。
. 选择*NVMe*；然后选择image:icon_add_blue_bg.png["蓝色背景的矩形图标、单词add以白色字母居中"]。
. 输入NVMe子系统的名称、选择主机操作系统并输入说明。
. 选择*添加启动程序*。


.下一步是什么？
此时、您的NVMe主机已添加到ASA R2系统中、您可以将主机映射到存储单元。

--
====


== 将存储单元映射到主机

创建ASA r2 存储单元并添加主机启动器后，将主机映射到存储单元以开始提供数据服务。存储单元在创建存储单元的过程中会被映射到主机。您还可以随时将现有存储单元映射到新的或现有的主机。

.步骤
. 选择*存储*。
. 将鼠标悬停在要映射的存储单元的名称上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*映射到主机*。
. 选择要映射到存储单元的主机，然后选择*Map*。


.下一步是什么？
存储单元已映射到主机、您可以在主机上完成配置过程。



== 完成主机端配置

创建存储单元、添加主机启动程序并映射存储单元后、您必须对主机执行以下步骤、然后才能在ASA R2系统上读取和写入数据。

.步骤
. 对于FC和FC/NVMe、按WWPN对FC交换机进行分区。
+
每个启动程序使用一个分区，并在每个分区中包含所有目标端口。

. 发现新存储单元。
. 初始化存储单元并创建文件系统。
. 确认主机可以读取和写入存储单元上的数据。


.下一步是什么？
您已完成配置过程并准备好开始提供数据。现在、您可以link:../data-protection/create-snapshots.html["创建快照"]保护ASA R2系统上的数据。

.了解更多信息
有关主机端配置的更多详细信息、请参见link:https://docs.netapp.com/us-en/ontap-sanhost/["ONTAP SAN主机文档"^]特定主机的。
