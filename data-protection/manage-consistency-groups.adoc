---
sidebar: sidebar 
permalink: data-protection/manage-consistency-groups.html 
keywords: consistency groups, snapshots, data protection, protect data, add, remove, delete, storage units, lun, namespace, increase capacity 
summary: 使用一致性组可同时对多个存储单元执行各种操作、而不是对每个单元单独执行操作。 
---
= 管理ASA R2存储系统上的ONTAP一致性组
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
一致性组是指作为单个单元进行管理的一组存储单元。使用一致性组简化存储管理。例如、假设您有一个数据库、其中一个一致性组包含10个存储单元、您需要备份整个数据库。您只需向一致性组添加快照数据保护、即可备份整个数据库、而无需备份每个存储单元。将存储单元备份为一致性组(而不是单独备份)还可以为所有单元提供一致的备份、而单独备份单元可能会造成不一致。

从ONTAP 9.161开始、您可以使用System Manager在ASA R2系统上创建分层一致性组。在分层结构中、一个或多个一致性组会配置为父一致性组下的子组。

通过分层一致性组、您可以将单个快照策略应用于每个子一致性组、并通过复制父一致性组将所有子一致性组的快照作为一个单元复制到远程集群。这样可以简化复杂数据结构的数据保护和管理。例如、假设您创建了一个名为的父一致性组 `SVM1_app`、其中包含两个子一致性组： `SVM1app_data`用于应用程序数据和 `SVM1app_logs`应用程序日志。的快照每15分钟创建一次、的 `SVM1app_logs`快照 `SVM1app_data`每小时创建一次。父一致性组 `SVM1_app,`具有一个SnapMirror策略、该策略每24小时将和 `SVM1app_logs`的快照复制 `SVM1app_data`到远程集群。父一致性组 `SVM1_app`作为一个单元进行管理、子一致性组作为单独的单元进行管理。



== 向一致性组添加Snapshot数据保护

向一致性组添加快照数据保护时、系统会根据预定义的计划定期创建一致性组的本地快照。

您可以对link:restore-data.html["还原数据"]丢失或损坏的使用快照。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要保护的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*Edit*。
. 在*本地保护*下，选择*计划快照*。
. 选择快照策略。
+
接受默认快照策略、选择现有策略或创建新策略。

+
[cols="2,6a"]
|===
| 选项 | 步骤 


| 选择现有快照策略  a| 
选择image:icon_dropdown_arrow.gif["向下指向蓝色箭头"]默认策略旁边的、然后选择要使用的现有策略。



| 创建新的快照策略  a| 
.. 选择image:icon_add.gif["蓝色加号后跟单词add"]；然后输入新策略名称。
.. 选择策略范围。
.. 在*日程 安排*下，选择image:icon_add.gif["蓝色加号后跟单词add"]。
.. 选择出现在*计划名称*下的名称；
+
然后选择。image:icon_dropdown_arrow.gif["蓝色箭头指向向下方向"]

.. 选择策略计划。
.. 在*最大快照数*下、输入要保留一致性组的最大快照数。
.. (可选)在* SnapMirror label*下输入SnapMirror标签。
.. 选择 * 保存 * 。


|===
. 选择 * 编辑 * 。


.下一步行动
现在、您的数据已通过快照进行保护、您应link:../secure-data/encrypt-data-at-rest.html["设置快照复制"]将一致性组复制到地理位置较远的位置、以便进行备份和灾难恢复。



== 从一致性组中删除Snapshot数据保护

从一致性组中删除快照数据保护后、此一致性组中的所有存储单元都会禁用快照。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要停止保护的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*Edit*。
. 在*本地保护*下、取消选择计划快照。
. 选择 * 编辑 * 。


.结果
不会为一致性组中的任何存储单元创建快照。



== 将存储单元添加到一致性组

通过向一致性组添加存储单元来扩展由一致性组管理的存储量。

您可以将现有存储单元添加到一致性组、也可以创建新存储单元以添加到一致性组。

[role="tabbed-block"]
====
.添加现有存储单元
--
.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要扩展的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*Expand*。
. 选择*使用现有存储单元*。
. 选择要添加到一致性组的存储单元；然后选择*扩展*。


--
.添加新存储单元
--
.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要扩展的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*Expand*。
. 选择*使用新存储单元*。
. 输入要创建的单位数和单位容量。
+
如果创建多个单元、则每个单元的容量和主机操作系统都相同。要为每个装置分配不同的容量，请选择*添加不同的容量*为每个装置分配不同的容量。

. 选择*展开*。


.下一步行动
创建新存储单元后，您应link:../manage-data/provision-san-storage.html#add-host-initiators["添加主机启动程序"]执行和link:../manage-data/provision-san-storage.html#map-the-storage-unit-to-a-host["将新创建的存储单元映射到主机"]。添加主机启动程序后、主机便有资格访问存储单元并执行数据操作。通过将存储单元映射到主机、存储单元可以开始向其映射到的主机提供数据。

--
====
.下一步是什么？
此一致性组的现有快照不会包含新添加的存储单元。您应link:create-snapshots.html#step-2-create-a-snapshot["创建即时快照"]使用一致性组来保护新添加的存储单元、直到自动创建下一个计划快照为止。



== 从一致性组中删除存储单元

如果要删除某个存储单元、将其作为其他一致性组的一部分进行管理、或者不再需要保护其包含的数据、则应从一致性组中删除该存储单元。从一致性组中删除存储单元会中断存储单元与一致性组之间的关系、但不会删除此存储单元。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 双击要从中删除存储单元的一致性组。
. 在*Overview*部分的*Storage units*下，选择要删除的存储单元，然后选择*Remove from s一 个一致性组*。


.结果
存储单元不再是一致性组的成员。

.下一步行动
如果您需要继续保护存储单元的数据、请将该存储单元添加到另一个一致性组。



== 将现有一致性组转换为父一致性组

存储单元不能直接与父一致性组关联。如果将现有一致性组转换为父一致性组、则会创建一个新的子一致性组、并且属于转换后的一致性组的存储单元会移动到新的子一致性组。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要转换为父一致性组的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*提升到父一致性组*。
. 输入父一致性组的名称或接受默认名称；然后选择一致性组组件类型。
. 选择*提升*。


.下一步是什么？
您可以在父一致性组下创建其他子一致性组。此外、您还可以link:../secure-data/encrypt-data-at-rest.html["设置快照复制"]将父一致性组复制到地理位置较远的位置、以便进行备份和灾难恢复。



== 创建子一致性组

通过创建子一致性组、您可以在父级将复制策略应用于所有子一致性组的同时、将单个快照策略应用于每个子一致性组。

您可以从新一致性组或现有一致性组创建子一致性组。

[role="tabbed-block"]
====
.从新一致性组
--
.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要添加子一致性组的父一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*添加新的子一致性组*。
. 输入子一致性组的名称或接受默认名称；然后选择一致性组组件类型。
. 选择此选项可将现有存储单元添加到子一致性组或创建新存储单元。
+
如果要创建新存储单元、请输入要创建的单元数和每个单元的容量、然后输入主机信息。

+
如果您创建多个存储单元、则每个存储单元都将使用相同的容量和相同的主机操作系统来创建。要为每个装置分配不同的容量，请选择*添加不同的容量*。

. 选择 * 添加 * 。


--
.从现有一致性组
--
.步骤
. 在System Manager中、选择*保护>一致性组*。
. 选择要创建子一致性组的现有一致性组。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*移动到不同的一致性组*。
+
如果要用作其他一致性组的子级的一致性组、则必须先将其从现有父一致性组中断开、然后才能将其移动到新的父一致性组。

. 为子一致性组输入新名称或接受默认名称；然后选择一致性组组件类型。
. 选择要创建父一致性组的现有一致性组、或者选择创建新的父一致性组。
+
如果选择创建新的父一致性组、请输入父一致性组的名称或接受默认名称；然后选择一致性应用程序组件类型。

. 选择*移动*。


--
====
.下一步行动
创建子一致性组后、您可以link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group["应用单个Snapshot保护策略"]对每个子一致性组执行此操作。您也可以link:snapshot-replication.html["设置复制策略"]在父一致性组上将所有子一致性组的快照作为一个单元复制到远程集群。



== 将父一致性组更改为单个一致性组

当您将父一致性组_子级_更改为单个一致性组时、关联子一致性组的存储单元将添加到父一致性组中。此时将删除子一致性组、并将父一致性组作为一个一致性组进行管理。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要删除的父一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*降级到单个一致性组*。
. 选择*Demote*


.下一步是什么？
link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group["添加Snapshot策略"]已将此一致性组进行了分级、以保护先前由子一致性组管理的存储单元。



== 将子一致性组与父一致性组分离

从父一致性组中断开子一致性组后、该子一致性组将从父一致性组中删除、并作为一个一致性组进行管理。应用于父级的复制策略将不再应用于已断开连接的子一致性组。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 选择父一致性组。
. 选择要断开的子一致性组。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*从父项断开*。
. 为要断开的一致性组输入新名称或接受默认名称；然后选择一致性组应用程序类型。
. 选择*Detach*。


.下一步是什么？
link:snapshot-replication.html["设置复制策略"]将已断开的子一致性组的快照作为一个一致性组复制到远程集群。



== 删除一致性组

如果您不再需要将一致性组的成员作为一个单元进行管理、则可以删除此一致性组。删除一致性组后、该组中先前的存储单元将在集群上保持活动状态。

.开始之前
如果要删除的一致性组位于复制关系中、则必须先中断此关系、然后再删除此一致性组。删除复制一致性组后、该一致性组中的存储单元在集群上保持活动状态、其复制的副本仍保留在远程集群上。

.步骤
. 在System Manager中、选择*保护>一致性组*。
. 将鼠标悬停在要删除的一致性组上。
. 选择image:icon_kabob.gif["三个垂直蓝点"]；然后选择*Delete*。
. 接受警告，然后选择*Delete*。


.下一步是什么？
删除一致性组后、一致性组中先前的存储单元不再受快照保护。请考虑将这些存储单元添加到另一个一致性组中、以防止数据丢失。
